# 1.上传文件
```shell
[student5@emr-header-1 haibo.duan]$ hadoop fs -mkdir /haibo.duan/week8
[student5@emr-header-1 haibo.duan]$ hadoop fs -put /home/student5/haibo.duan/finances.json  /haibo.duan/week8
22/06/25 22:22:40 INFO sasl.SaslDataTransferClient: SASL encryption trust check: localHostTrusted = false, remoteHostTrusted = false
[student5@emr-header-1 haibo.duan]$ hadoop fs -ls  /haibo.duan/week8
Found 1 items
-rw-r-----   2 student5 hadoop        570 2022-06-25 22:22 /haibo.duan/week8/finances.json
[student5@emr-header-1 haibo.duan]$ 
```

# 2.建表
通过上传的文件，以json的方式建表
```shell
spark-sql> CREATE TEMPORARY TABLE t_finance_dhb USING org.apache.spark.sql.json  OPTIONS (path '/haibo.duan/week8/finances.json');
22/06/25 22:24:57 WARN [main] SparkSqlAstBuilder: CREATE TEMPORARY TABLE ... USING ... is deprecated, please use CREATE TEMPORARY VIEW ... USING ... instead
Time taken: 0.796 seconds
spark-sql> select * from t_finance_dhb;
{"FirstName":"Jay","LastName":"Smith","Number":"123-ABC-789"}	1.23	1/1/2015	Drug Store	1	NULL
{"FirstName":"Sally","LastName":"Fuller","Number":"456-DEF-456"}	200.0	1/3/2015	Electronics	2	NULL
NULL	NULL	NULL	NULL	NULL	{"ID":3,"Account":{"Number":"333-XYZ-999","FirstName":"Brad","LastName":"Turner"},"Date":"1/4/2015","Amount":106.00,"Description":"Gas},
{"FirstName":"Justin","LastName":"Pihony","Number":"987-CBA-321"}	0.0	1/4/2015	Drug Store	4	NULL
Time taken: 0.216 seconds, Fetched 4 row(s)
```

# 3.第一问sql
```sql
select  amount_a + amount_b + 1, ID, (case when true then "1" when false then "2" else "3" end) as c
 from ( select Amount + 1 AS amount_a, Amount + 2 AS amount_2, ID, `Date` from ( select * FROM t_finance_dhb where ID < 30 ) WHERE ID > 5  )
WHERE ID < 20;
```
执行结果：
```shell
spark-sql> select  amount_a + amount_b + 1, ID, (case when true then "1" when false then "2" else "3" end) as c
         > from ( select Amount + 1 AS amount_a, Amount + 2 AS amount_2, ID, `Date` from ( select * FROM t_finance_dhb where ID < 30 ) WHERE ID > 5  )
         > WHERE ID < 20;
Error in query: cannot resolve 'amount_b' given input columns: [__auto_generated_subquery_name.Date, __auto_generated_subquery_name.ID, __auto_generated_subquery_name.amount_2, __auto_generated_subquery_name.amount_a]; line 1 pos 19;
'Project [unresolvedalias(((amount_a#19 + 'amount_b) + 1), None), ID#11L, CASE WHEN true THEN 1 WHEN false THEN 2 ELSE 3 END AS c#21]
+- Filter (ID#11L < cast(20 as bigint))
   +- SubqueryAlias __auto_generated_subquery_name
      +- Project [(Amount#8 + cast(1 as double)) AS amount_a#19, (Amount#8 + cast(2 as double)) AS amount_2#20, ID#11L, Date#9]
         +- Filter (ID#11L > cast(5 as bigint))
            +- SubqueryAlias __auto_generated_subquery_name
               +- Project [Account#7, Amount#8, Date#9, Description#10, ID#11L, _corrupt_record#12]
                  +- Filter (ID#11L < cast(30 as bigint))
                     +- SubqueryAlias t_finance_dhb
                        +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
                           +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json

```

# 4.第二问sql
```sql
select  A, ID
from ( select distinct ID, `Date`, Amount + 0.2 - 0.1 AS A, Amount + 2 AS B from t_finance_dhb WHERE ID > 5  )
WHERE ID < 20
except DISTINCT select Amount + 0.2 as A, ID from  t_finance_dhb WHERE ID > 25;
```
执行结果：

```shell
   > select  A, ID
         > from ( select distinct ID, `Date`, Amount + 0.2 - 0.1 AS A, Amount + 2 AS B from t_finance_dhb WHERE ID > 5  )
         > WHERE ID < 20
         > except DISTINCT select Amount + 0.2 as A, ID from  t_finance_dhb WHERE ID > 25;
22/06/25 22:44:58 WARN [main] PlanChangeLogger: Batch Substitution has no effect.
22/06/25 22:44:58 WARN [main] PlanChangeLogger: Batch Disable Hints has no effect.
22/06/25 22:44:58 WARN [main] PlanChangeLogger: Batch Hints has no effect.
22/06/25 22:44:58 WARN [main] PlanChangeLogger: Batch Simple Sanity Check has no effect.
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveRelations ===
 'Except false                                                                                  'Except false
 :- 'Project ['A, 'ID]                                                                          :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                       :  +- 'Filter ('ID < 20)
 :     +- 'SubqueryAlias __auto_generated_subquery_name                                         :     +- 'SubqueryAlias __auto_generated_subquery_name
 :        +- 'Distinct                                                                          :        +- 'Distinct
 :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]   :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]
 :              +- 'Filter ('ID > 5)                                                            :              +- 'Filter ('ID > 5)
!:                 +- 'UnresolvedRelation [t_finance_dhb], [], false                            :                 +- SubqueryAlias t_finance_dhb
!+- 'Project [('Amount + 0.2) AS A#70, 'ID]                                                     :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
!   +- 'Filter ('ID > 25)                                                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
!      +- 'UnresolvedRelation [t_finance_dhb], [], false                                        +- 'Project [('Amount + 0.2) AS A#70, 'ID]
!                                                                                                  +- 'Filter ('ID > 25)
!                                                                                                     +- SubqueryAlias t_finance_dhb
!                                                                                                        +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
!                                                                                                           +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.DeduplicateRelations ===
 'Except false                                                                                                          'Except false
 :- 'Project ['A, 'ID]                                                                                                  :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                                               :  +- 'Filter ('ID < 20)
 :     +- 'SubqueryAlias __auto_generated_subquery_name                                                                 :     +- 'SubqueryAlias __auto_generated_subquery_name
 :        +- 'Distinct                                                                                                  :        +- 'Distinct
 :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]                           :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]
 :              +- 'Filter ('ID > 5)                                                                                    :              +- 'Filter ('ID > 5)
 :                 +- SubqueryAlias t_finance_dhb                                                                       :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])   :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json          :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- 'Project [('Amount + 0.2) AS A#70, 'ID]                                                                             +- 'Project [('Amount + 0.2) AS A#70, 'ID]
    +- 'Filter ('ID > 25)                                                                                                  +- 'Filter ('ID > 25)
       +- SubqueryAlias t_finance_dhb                                                                                         +- SubqueryAlias t_finance_dhb
!         +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])                        +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
!            +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json                                  +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveReferences ===
 'Except false                                                                                                          'Except false
 :- 'Project ['A, 'ID]                                                                                                  :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                                               :  +- 'Filter ('ID < 20)
 :     +- 'SubqueryAlias __auto_generated_subquery_name                                                                 :     +- 'SubqueryAlias __auto_generated_subquery_name
 :        +- 'Distinct                                                                                                  :        +- 'Distinct
 :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]                           :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]
!:              +- 'Filter ('ID > 5)                                                                                    :              +- 'Filter (ID#11L > 5)
 :                 +- SubqueryAlias t_finance_dhb                                                                       :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])   :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json          :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- 'Project [('Amount + 0.2) AS A#70, 'ID]                                                                             +- 'Project [('Amount + 0.2) AS A#70, 'ID]
!   +- 'Filter ('ID > 25)                                                                                                  +- 'Filter (ID#75L > 25)
       +- SubqueryAlias t_finance_dhb                                                                                         +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                     +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                               +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.TypeCoercionBase$CombinedTypeCoercionRule ===
 'Except false                                                                                                          'Except false
 :- 'Project ['A, 'ID]                                                                                                  :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                                               :  +- 'Filter ('ID < 20)
 :     +- 'SubqueryAlias __auto_generated_subquery_name                                                                 :     +- 'SubqueryAlias __auto_generated_subquery_name
 :        +- 'Distinct                                                                                                  :        +- 'Distinct
 :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]                           :           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]
!:              +- 'Filter (ID#11L > 5)                                                                                 :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                       :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])   :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json          :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- 'Project [('Amount + 0.2) AS A#70, 'ID]                                                                             +- 'Project [('Amount + 0.2) AS A#70, 'ID]
!   +- 'Filter (ID#75L > 25)                                                                                               +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                         +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                     +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                               +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveReferences ===
 'Except false                                                                                                          'Except false
 :- 'Project ['A, 'ID]                                                                                                  :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                                               :  +- 'Filter ('ID < 20)
 :     +- 'SubqueryAlias __auto_generated_subquery_name                                                                 :     +- 'SubqueryAlias __auto_generated_subquery_name
 :        +- 'Distinct                                                                                                  :        +- 'Distinct
!:           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]                           :           +- 'Project [ID#11L, Date#9, ((Amount#8 + 0.2) - 0.1) AS A#68, (Amount#8 + 2) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                  :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                       :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])   :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json          :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
!+- 'Project [('Amount + 0.2) AS A#70, 'ID]                                                                             +- 'Project [(Amount#72 + 0.2) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                         +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                     +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                               +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.ResolveTimeZone ===
 'Except false                                                                                                          'Except false
 :- 'Project ['A, 'ID]                                                                                                  :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                                               :  +- 'Filter ('ID < 20)
 :     +- 'SubqueryAlias __auto_generated_subquery_name                                                                 :     +- 'SubqueryAlias __auto_generated_subquery_name
 :        +- 'Distinct                                                                                                  :        +- 'Distinct
 :           +- 'Project [ID#11L, Date#9, ((Amount#8 + 0.2) - 0.1) AS A#68, (Amount#8 + 2) AS B#69]                     :           +- 'Project [ID#11L, Date#9, ((Amount#8 + 0.2) - 0.1) AS A#68, (Amount#8 + 2) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                  :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                       :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])   :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json          :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- 'Project [(Amount#72 + 0.2) AS A#70, ID#75L]                                                                        +- 'Project [(Amount#72 + 0.2) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                         +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                     +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                               +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.TypeCoercionBase$CombinedTypeCoercionRule ===
 'Except false                                                                                                          'Except false
 :- 'Project ['A, 'ID]                                                                                                  :- 'Project ['A, 'ID]
 :  +- 'Filter ('ID < 20)                                                                                               :  +- 'Filter ('ID < 20)
!:     +- 'SubqueryAlias __auto_generated_subquery_name                                                                 :     +- SubqueryAlias __auto_generated_subquery_name
!:        +- 'Distinct                                                                                                  :        +- Distinct
!:           +- 'Project [ID#11L, Date#9, ((Amount#8 + 0.2) - 0.1) AS A#68, (Amount#8 + 2) AS B#69]                     :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                  :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                       :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])   :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json          :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
!+- 'Project [(Amount#72 + 0.2) AS A#70, ID#75L]                                                                        +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                         +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                     +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                               +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveReferences ===
 'Except false                                                                                                                                       'Except false
 :- 'Project ['A, 'ID]                                                                                                                               :- 'Project ['A, 'ID]
!:  +- 'Filter ('ID < 20)                                                                                                                            :  +- 'Filter (ID#11L < 20)
 :     +- SubqueryAlias __auto_generated_subquery_name                                                                                               :     +- SubqueryAlias __auto_generated_subquery_name
 :        +- Distinct                                                                                                                                :        +- Distinct
 :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]   :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                                               :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                                                    :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])                                :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]                                                                                      +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                                             +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                                                      +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                                                  +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                                                            +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.ResolveTimeZone ===
 'Except false                                                                                                                                       'Except false
 :- 'Project ['A, 'ID]                                                                                                                               :- 'Project ['A, 'ID]
 :  +- 'Filter (ID#11L < 20)                                                                                                                         :  +- 'Filter (ID#11L < 20)
 :     +- SubqueryAlias __auto_generated_subquery_name                                                                                               :     +- SubqueryAlias __auto_generated_subquery_name
 :        +- Distinct                                                                                                                                :        +- Distinct
 :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]   :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                                               :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                                                    :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])                                :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]                                                                                      +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                                             +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                                                      +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                                                  +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                                                            +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.TypeCoercionBase$CombinedTypeCoercionRule ===
 'Except false                                                                                                                                       'Except false
 :- 'Project ['A, 'ID]                                                                                                                               :- 'Project ['A, 'ID]
!:  +- 'Filter (ID#11L < 20)                                                                                                                         :  +- Filter (ID#11L < cast(20 as bigint))
 :     +- SubqueryAlias __auto_generated_subquery_name                                                                                               :     +- SubqueryAlias __auto_generated_subquery_name
 :        +- Distinct                                                                                                                                :        +- Distinct
 :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]   :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                                               :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                                                    :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])                                :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]                                                                                      +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                                             +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                                                      +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                                                  +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                                                            +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveReferences ===
!'Except false                                                                                                                                       Except false
!:- 'Project ['A, 'ID]                                                                                                                               :- Project [A#68, ID#11L]
 :  +- Filter (ID#11L < cast(20 as bigint))                                                                                                          :  +- Filter (ID#11L < cast(20 as bigint))
 :     +- SubqueryAlias __auto_generated_subquery_name                                                                                               :     +- SubqueryAlias __auto_generated_subquery_name
 :        +- Distinct                                                                                                                                :        +- Distinct
 :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]   :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                                               :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                                                    :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])                                :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]                                                                                      +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                                             +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                                                      +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                                                  +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                                                            +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Applying Rule org.apache.spark.sql.catalyst.analysis.ResolveTimeZone ===
 Except false                                                                                                                                        Except false
 :- Project [A#68, ID#11L]                                                                                                                           :- Project [A#68, ID#11L]
 :  +- Filter (ID#11L < cast(20 as bigint))                                                                                                          :  +- Filter (ID#11L < cast(20 as bigint))
 :     +- SubqueryAlias __auto_generated_subquery_name                                                                                               :     +- SubqueryAlias __auto_generated_subquery_name
 :        +- Distinct                                                                                                                                :        +- Distinct
 :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]   :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
 :              +- Filter (ID#11L > cast(5 as bigint))                                                                                               :              +- Filter (ID#11L > cast(5 as bigint))
 :                 +- SubqueryAlias t_finance_dhb                                                                                                    :                 +- SubqueryAlias t_finance_dhb
 :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])                                :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
 :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
 +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]                                                                                      +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
    +- Filter (ID#75L > cast(25 as bigint))                                                                                                             +- Filter (ID#75L > cast(25 as bigint))
       +- SubqueryAlias t_finance_dhb                                                                                                                      +- SubqueryAlias t_finance_dhb
          +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])                                                  +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
             +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json                                                            +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
           
22/06/25 22:44:58 WARN [main] PlanChangeLogger: 
=== Result of Batch Resolution ===
!'Except false                                                                                  Except false
!:- 'Project ['A, 'ID]                                                                          :- Project [A#68, ID#11L]
!:  +- 'Filter ('ID < 20)                                                                       :  +- Filter (ID#11L < cast(20 as bigint))
!:     +- 'SubqueryAlias __auto_generated_subquery_name                                         :     +- SubqueryAlias __auto_generated_subquery_name
!:        +- 'Distinct                                                                          :        +- Distinct
!:           +- 'Project ['ID, 'Date, (('Amount + 0.2) - 0.1) AS A#68, ('Amount + 2) AS B#69]   :           +- Project [ID#11L, Date#9, ((Amount#8 + cast(0.2 as double)) - cast(0.1 as double)) AS A#68, (Amount#8 + cast(2 as double)) AS B#69]
!:              +- 'Filter ('ID > 5)                                                            :              +- Filter (ID#11L > cast(5 as bigint))
!:                 +- 'UnresolvedRelation [t_finance_dhb], [], false                            :                 +- SubqueryAlias t_finance_dhb
!+- 'Project [('Amount + 0.2) AS A#70, 'ID]                                                     :                    +- View (`t_finance_dhb`, [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12])
!   +- 'Filter ('ID > 25)                                                                       :                       +- Relation [Account#7,Amount#8,Date#9,Description#10,ID#11L,_corrupt_record#12] json
!      +- 'UnresolvedRelation [t_finance_dhb], [], false                                        +- Project [(Amount#72 + cast(0.2 as double)) AS A#70, ID#75L]
!                                                                                                  +- Filter (ID#75L > cast(25 as bigint))
!                                                                                                     +- SubqueryAlias t_finance_dhb
!                                                                                                        +- View (`t_finance_dhb`, [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76])
!                                                                                                           +- Relation [Account#71,Amount#72,Date#73,Description#74,ID#75L,_corrupt_record#76] json
          
```